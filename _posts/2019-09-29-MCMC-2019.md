---
layout:     post   				    # 使用的布局（不需要改）
title:      MCMC 				# 标题 
subtitle:   Markov Chain and Monte Carlo          #副标题
date:       2019-09-29 				# 时间
author:     WYX 						# 作者
header-img: img/1.6.png 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - MCMC

---



# Markov Chain & Monte Carlo





$$
Inference \Rightarrow 
\begin{cases}
精确推断\\
近似推断 \begin{cases}
确定性 &\Rightarrow Variational Inference \\
随机 &\Rightarrow MCMC
\end{cases}
\end{cases}
$$






## 蒙特卡洛方法 Monte Carlo Method 

### 目标

蒙特卡洛方法意在解决复杂函数的期望，如下


$$
E_{z|x}[f(z)] = \int p(z|x)f(z) dz \tag{1}
$$


因为 f(z) 函数以及 p(z|x) 函数过于复杂或者无法找到显式的表达式，所以使得积分难以求解

如果可以获得 $z_1,z_2,\ldots,z_N \sim p(z|x)$  服从后验概率密度函数的 N 个样本点，则上式  (1) 可以使用 （2） 近似


$$
E_{z|x}[f(z)] = \int p(z|x)f(z) dz \approx \frac{1}{N}\sum \limits_{i=1}^N f(z_i) \tag{2}
$$

#### 如何从复杂分布中采样

以下不对具体方法进行重复，只说明理解过程中遇到的问题

##### 根据马氏链的收敛性进行采样

已知**特定**的概率转移矩阵 **P** 存在以下性质
$$
\lim \limits_{n\rightarrow \infty} P^{n} = \pi(j)
$$
其中 $\pi(j)$ 为平稳分布，平稳分布与初始状态的选取无关，只与特定的矩阵 **P** 相关

**马氏链每一个节点对应一个分布（也就是一个状态），每一个状态都会别抽取一个样本，也就是每个节点都会有相应的样本**

假设初始概率分布如下
$$
[0.3,0.4,0.3]
$$
则初始状态为根据上述概率分布选取的一个样本$\in{1,2,3}$ 分别对应上述 0.3,0.4,0.3 的概率，假设初始状态为 **1**


$$
\pi(2) = \pi(1) \times \textbf{P} \tag{3}
$$
上式对应一次马氏链状态的跳跃。

但是，在状态 2下抽取样本，要根据其**相应转移矩阵的概率**进行采样，也就是 **P(状态2|X=1)** 。马氏链每进行一次状态的转移，都要根据前一个样本的状态对**相应的转移矩阵的概率**进行采样


$$
\pi(3) = \pi(2)\times \textbf{P} \\
\space \\
=\pi(1) \times \textbf{P}^2
$$
**则 $P$** 矩阵每一次自乘就是一次状态的更新。状态2下的第二个样本要根据 $P(x_1,x_2,x_3| X = 1)$ 进行抽样。则该样本算作从 $\pi(2)$ 进行的抽样

每一次状态更新后，新的状态计算如下

则如果当前状态值为 1 的话，在新状态下，只需要沿着 $ P(p_{11}|oldX_1),P(p_{12}|oldX_1),P(p_{13}|oldX_1)$ 采样即可
$$
P(newX_1) = P(oldX_1) \times P(p_{11}|oldX_1) + P(oldX_2) \times P(p_{21}|oldX_2) + P(oldX_3) \times P(p_{31}|oldX_3)\\
\space \\
P(newX_2) = P(oldX_1) \times P(p_{12}|oldX_1) + P(oldX_2) \times P(p_{22}|oldX_2) + P(oldX_3) \times P(p_{32}|oldX_3)\\
\space \\
P(newX_3) = P(oldX_1) \times P(p_{13}|oldX_1) + P(oldX_2) \times P(p_{23}|oldX_2) + P(oldX_3) \times P(p_{33}|oldX_3)
$$







$$
\textbf{P} = \left\{
\begin{matrix}
0.9 & 0.05 & 0.05\\
0.15 & 0.8 & 0.05 \\
0.25 & 0.25 & 0.5
\end{matrix}
\right\}_{3x3}
$$
