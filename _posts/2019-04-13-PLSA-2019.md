---
layout:     post   				    # 使用的布局（不需要改）
title:      PLSA 				# 标题 
subtitle:   Hello World, Hello Blog #副标题
date:       2019-04-13 				# 时间
author:     WYX 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - PGM
---

# Result derivation

## KL Divergence

* The common formula of KL divergence is:
  $$
  \mathrm{KL}(\mathrm{f}(\mathrm{x}) \| \mathrm{g}(\mathrm{x}))=\sum_{x \in X} f(x) * \log _{2} \frac{f(x)}{g(x)}
  $$

* In the paper, the last term is the KL divergence of Uniform distribution and $p(t_s|z,s)​$

  

The following is the result from the paper
$$
\mathcal{L}_{c}(\mathcal{D} | \Theta)=\mathcal{L}(\mathcal{D} | \Theta)-\sum_{t_{s}, z, d} \frac{\lambda_{z, d}}{T_{d s}} \cdot \log \left(p\left(t_{s} | z, d\right)\right) \tag{1}
$$
Ignore the weight parameter $\lambda_{z,d}​$, the KL divergence should be
$$
\sum_{t_s,z,d} \frac{1}{T_{ds} - 0} \cdot log(\frac{\frac{1}{T_{ds} - 0}}{(p(t_s|z,d)})
$$
**One guess**(Verified):
$$
\sum_{t_s,z,d} \frac{1}{T_{ds} - 0} \cdot log(\frac{\frac{1}{T_{ds} - 0}}{(p(t_s|z,d)})\\
= \sum_{t_s,z,d} \frac{1}{T_{ds} - 0} \cdot [\underbrace {log({\frac{1}{T_{ds} - 0}})}_{constant} - log(p(t_s|z,d))]
$$


## EM Algo

$$
\begin{aligned} E[\mathcal{L}]=\sum_{d=1}^{D} \sum_{w=1}^{N_{w}} & \sum_{t_{a}=1}^{T_{d}} \sum_{z=1}^{N_{z}} \sum_{t_{s}=1}^{T_{d s}} n\left(w, t_{a}, d\right) p\left(z, t_{s} | w, t_{a}, d\right) \log p\left(w, t_{a}, d, z, t_{s}\right) \\ &-\sum_{t_{s}, z, d} \frac{\lambda_{z, d}}{T_{d s}} \cdot \log \left(p\left(t_{s} | z, d\right)\right) \end{aligned}
$$



$p(w,t_d,d,z,t_s) = p(d)p(z|d)p(ts|z,d)p(w,tr|z)$



### E step

$$
p\left(z, t_{s} | w, t_{a}, d\right)=\frac{p\left(w, t_{a}, d, z, t_{s}\right)}{p\left(w, t_{a}, d\right)} \text { with } p\left(w, t_{a}, d\right)=\sum_{z=1}^{N_{z}} \sum_{t_{s}=1}^{T_{d s}} p\left(w, t_{a}, d, z, t_{s}\right)
$$



### M-step



Build the Lagrange function, the original function $E[L]$ has  constraints 


$$
\sum_{j=1}^{N_w} \sum_{i=1}^{N_{tr}} p(w_j,tr_i|z) = 1 \\
\sum_{k=1}^{N_z} \sum_{i=1}^{N_{ts}} p(z_k,ts_i|d) = 1
$$


$p(z,ts|d) = p(z|d)p(t_s|z,d)$

#### Build Lagrange function

One guess that needs to be verified:

> Along with the constraint that each of the distributions sum to one. p10

Given one document, we could derive:
$$
\sum_{k=1}^{N_z}\sum_{i=1}^{N_{ts}}p(z_k,ts_i|d) = 1 \tag{1}
$$

$$
\sum_{k=1}^{N_z}\sum_{i=1}^{N_{ts}}p(w_k,ts_i|z_k,d) = 1 \tag{2}
$$

**Lagrange function** can  be expressed as follows:
$$
Lag = E[\mathcal{L}] +\lambda_1 (1 -\sum_{j=1}^{N_w} \sum_{i=1}^{N_{tr}} p(w_j,tr_i|z) ) +\\ \lambda_2(1-\sum_{k=1}^{N_z} \sum_{i=1}^{N_{ts}} p(z_k,ts_i|d))\\
$$

$$
= \sum_{d=1}^{D} \sum_{w=1}^{N_w} \sum_{t_a=1}^{T_d}\sum_{z=1}^{N_z}\sum_{t_s=1}^{T_{ds}} n(w,t_a,d) p(z,t_s|w,t_a,d)\cdot [log(p(d)) + log(p(z|d))\\ + log(p(t_s|z,d)) + log(w|tr,z)+log(tr|z)] \\
+ \lambda_1 (1 -\sum_{j=1}^{N_w} \sum_{i=1}^{N_{tr}} p(w_j,tr_i|z) ) +\\ \lambda_2(1-\sum_{k=1}^{N_z} \sum_{i=1}^{N_{ts}} p(z_k,ts_i|d))
$$





**Solve $p(w,t_r|z)$**

Because we want to derive $p(w,t_r|z)$, $t_r$ is decided by $t_a-t_s$,and this probability is based on given topic z. So two sums can be eliminated $\sum_{w = 1}^{N_w} \sum_{z=1}^{N_z}$ 
$$
\frac{\partial Lag}{p(w,t_r|z)} =\frac{\sum_{d=1}^{D} \sum_{ta=1}^{T_d} \sum_{ts=1}^{T_ds} \left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right)}{p(w,t_r|z)} -\lambda_1
$$


Because
$$
\sum_{k=1}^{N_z}\sum_{i=1}^{N_{ts}}p(w_k,ts_i|z_k,d) = 1 \tag{2}
$$
##### **$p(z|d)$** can be solved from $\lambda_1$ 

$$
\frac{\partial Lag}{p(z_k|d)} =\frac{\sum_{d=1}^{D} \sum_{ta=1}^{T_d} \sum_{ts=1}^{T_{ds}} \left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right)}{p(w,t_r|z)} -\lambda_1
$$

$$
\Longrightarrow \sum_{d=1}^{D} \sum_{ta=1}^{T_d} \sum_{ts=1}^{T_{ds}} \left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right) = \lambda_1 p(w,t_r|z)
$$

$$
\Longrightarrow \sum_{k=1}^{N_z}\sum_{i=1}^{N_{ts}} \sum_{d=1}^{D} \sum_{ta=1}^{T_d} \sum_{ts=1}^{T_ds} \left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right)= \sum_{k=1}^{N_z}\sum_{i=1}^{N_{ts}} \lambda_1 p(w,t_r|z)
$$

$$
\Longrightarrow \sum_{k=1}^{N_z}\sum_{t_{s}=1}^{T_{d s}} \sum_{t_{r}=0}^{T_{z}-1} \sum_{w=1}^{N_{w}} n\left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right) = \lambda_1 \sum_{k=1}^{N_z} p(z_k|d)
$$

$$
\Longrightarrow \sum_{k=1}^{N_z}\sum_{t_{s}=1}^{T_{d s}} \sum_{t_{r}=0}^{T_{z}-1} \sum_{w=1}^{N_{w}} n\left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right) = \lambda_1 \\
$$



Take $\lambda_1$ Back , we have 
$$
\sum_{t_{s}=1}^{T_{d s}} \sum_{t_{r}=0}^{T_{z}-1} \sum_{w=1}^{N_{w}} n\left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right) = \lambda_1 p(z_k|d) \\
\Longrightarrow p(z_k|d) = \frac{\sum_{t_{s}=1}^{T_{d s}} \sum_{t_{r}=0}^{T_{z}-1} \sum_{w=1}^{N_{w}} n\left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right)}{\sum_{k=1}^{N_z}\sum_{t_{s}=1}^{T_{d s}} \sum_{t_{r}=0}^{T_{z}-1} \sum_{w=1}^{N_{w}} n\left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right) }
$$



**Note**: After E-step, $p(z,ts|w,t_s,ta,d)$ is a constant



Because of $\sum_{k=1}^{N_z} and \sum_{t_s}^{T_{ds}}$ , $p(z,t_s|w,t_s + t_r,d)$ is 1
$$
p\left(z_k, t_{s} | w, t_{a}, d\right)=\frac{p\left(w, t_{a}, d, z_k, t_{s}\right)}{\sum_{z}^{N_z} \sum_{t_s}^{T_{ds}} p\left(w, t_{a}, d\right)}
$$
Results mentioned in the paper
$$
p(z | d) \propto \sum_{t_{s}=1}^{T_{d s}} \sum_{t_{r}=0}^{T_{z}-1} \sum_{w=1}^{N_{w}} n\left(w, t_{s}+t_{r}, d\right) p\left(z, t_{s} | w, t_{s}+t_{r}, d\right)
$$
